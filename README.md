# 東京都立大学システムデザイン学部・研究科 インダストリアルアート学科・学域 卒業・修了制作研究展 2026

## 開発について

- パッケージ
  - pnpm でパッケージの管理
- 日英対応
  - 文章は基本的に全て public/locales/配下で管理し、言語切り替えに対応
  - client コンポーネントで出し分けを行う
    - 'use client'がファイルのトップにあるもの
- ブランチ
  - 機能単位でブランチ切る
  - staging で他班と共有？

### ファイル構造

- app/i18n.ts
  - 言語切り替え
- app/\[locale\]
  - 基本的にこの中をいじる
  - ブラウザ言語によって ja/en が切り替わる
    - ja の時は prefix なし
    - en の時に url に/en が入る(ja: /works, en: /en/works)
  - page.tsx
    - トップページ
  - layout.tsx
    - 全てのページに共通する要素を設定
  - components
    - 再利用可能なパーツを格納
  - features
    - 機能を含む UI を格納(.tsx)
  - lib
    - 機能を提供（.ts）
  - works
    - page.tsx
      - 作品一覧ページ
    - \[slug\]
      - page.tsx
        - 個別作品ページ
- public
  - locales
    - 基本的に全ての文章をここで管理、日英で出しわけ

## 運用・デプロイ

本プロジェクトは **`main` ブランチの `out` ディレクトリの中身** が自動的に本番サーバ（`/ge2026/` 配下）にデプロイされる運用になっています。

### デプロイの手順

変更を本番環境に反映させるには、以下の手順で `out` ディレクトリを更新してコミットする必要があります。

1. **変更の実装と確認**
   ローカルで開発を行い、動作確認を完了させます。

2. **ビルド（静的ファイルの生成）**
   以下のコマンドを実行して、`out` ディレクトリを再生成します。

   ```bash
   pnpm build
   ```

   ※ このコマンドにより、`out` ディレクトリの中身が最新の状態に更新されます。

3. **自動デプロイ**
   Github の main ブランチへのプッシュをトリガーに、自動的にサーバへのアップロードが行われます。

### 注意点

- **必ずビルドしてからコミットしてください**
  ソースコードだけを変更してコミットしても、`out` ディレクトリが更新されていないと本番環境には反映されません。
- **`out` ディレクトリは Git 管理対象です**
  通常、ビルド生成物は `.gitignore` に含めますが、本プロジェクトではデプロイ運用のため意図的に管理対象としています。

## 環境構築

このプロジェクトを開発するために必要なソフトウェアと、そのセットアップ方法を説明します。Web アプリ開発が初めての方でも、この手順に従って環境を構築できます。

### 必要なソフトウェア

以下のソフトウェアが必要です：

1. **Git** - ソースコードのバージョン管理ツール
2. **Node.js** (バージョン 22.x 推奨) - JavaScript の実行環境
3. **pnpm** - Node.js のパッケージ管理ツール
4. **エディタ** (推奨: Visual Studio Code または Cursor) - コードを編集するためのソフトウェア

### セットアップ手順

#### 1. Git のインストール

Git は、ソースコードの変更履歴を管理するためのツールです。

**macOS の場合：**

- Xcode Command Line Tools がインストールされていれば、Git も含まれています
- ターミナルを開いて、以下のコマンドでインストールを確認します：

  ```bash
  git --version
  ```

- インストールされていない場合は、以下のコマンドでインストールできます：

  ```bash
  xcode-select --install
  ```

**Windows の場合：**

- [Git for Windows](https://git-scm.com/download/win) からインストーラーをダウンロードしてインストールしてください

**Linux の場合：**

- パッケージマネージャーを使用してインストールします（例：Ubuntu/Debian の場合）

  ```bash
  sudo apt update
  sudo apt install git
  ```

#### 2. Node.js のインストール

Node.js は、JavaScript をサーバー側で実行するための環境です。このプロジェクトでは、バージョン 22.x が必要です。

##### 推奨方法：nvm を使用する場合

nvm（Node Version Manager）を使用すると、複数の Node.js バージョンを簡単に切り替えられます。

**macOS / Linux の場合：**

1. ターミナルを開いて、以下のコマンドで nvm をインストールします：
   （インストールの例：バージョン等が異なる場合があります）

   ```bash
   curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
   ```

2. ターミナルを再起動するか、以下のコマンドを実行します：

   ```bash
   source ~/.bashrc
   # または
   source ~/.zshrc
   ```

3. nvm がインストールされたことを確認します：

   ```bash
   nvm --version
   ```

4. Node.js をインストールします（プロジェクトには`.nvmrc`ファイルが含まれているため、自動的に正しいバージョンがインストールされます）：

   ```bash
   nvm install
   nvm use
   ```

5. インストールされたことを確認します：

   ```bash
   node --version
   ```

   バージョンが 20.20.0 以上であることを確認してください。

**Windows の場合：**

- [nvm-windows](https://github.com/coreybutler/nvm-windows/releases) からインストーラーをダウンロードしてインストールしてください
- インストール後、ターミナルを再起動して以下のコマンドを実行します：

  ```bash
  nvm install 22
  nvm use 22
  ```

**nvm を使用しない場合：**

- [Node.js の公式サイト](https://nodejs.org/ja/) から LTS 版（推奨版）をダウンロードしてインストールしてください
- インストール後、ターミナルで以下のコマンドでバージョンを確認します：

  ```bash
  node --version
  ```

  バージョンが 22.x であることを確認してください。

#### 3. pnpm のインストール

pnpm は、Node.js のパッケージ（ライブラリ）を管理するためのツールです。

**インストール方法：**

pnpm 公式が推奨している方法でインストールします。

**macOS / Linux の場合:**

````bash
curl -fsSL https://get.pnpm.io/install.sh | sh -

インストールが完了したら、以下のコマンドで確認します：

```bash
pnpm --version
````

#### 4. エディタのインストール（推奨）

コードを編集するために、エディタが必要です。以下のいずれかをインストールしてください。

##### Cursor（推奨）

Cursor は AI 機能を統合したエディタで、コード補完や質問への回答など、開発をサポートする機能が充実しています。

- [Cursor の公式サイト](https://cursor.sh/) からダウンロードしてインストールしてください
- AI 機能により、コードの理解や実装のサポートが受けられます

##### Visual Studio Code（VS Code）

VS Code は、Microsoft が開発した無料のエディタです。豊富な拡張機能が利用できます。

- [Visual Studio Code の公式サイト](https://code.visualstudio.com/) からダウンロードしてインストールしてください

##### 推奨拡張機能

Cursor または VS Code のいずれを使用する場合でも、以下の拡張機能をインストールすることを推奨します。これらにより、コードの品質向上と開発効率の向上が期待できます。

- **ESLint** - コードの品質チェックを行い、潜在的な問題を検出します
- **Prettier** - コードの自動フォーマットを行い、コードスタイルを統一します
- **TypeScript** - TypeScript の型チェックと IntelliSense を提供します

拡張機能のインストール方法：

- **Cursor**: 左側の拡張機能アイコン（または `Cmd + Shift + X` / `Ctrl + Shift + X`）から検索してインストール
- **VS Code**: 左側の拡張機能アイコン（または `Cmd + Shift + X` / `Ctrl + Shift + X`）から検索してインストール

#### 5. リポジトリのクローン

プロジェクトのソースコードを自分の PC にダウンロードします。

1. ターミナルを開きます
2. プロジェクトを保存したいディレクトリに移動します（例：デスクトップ）

   ```bash
   cd ~/Desktop
   ```

3. リポジトリをクローンします：

   ```bash
   git clone <リポジトリのURL>
   ```

4. プロジェクトのディレクトリに移動します：

   ```bash
   cd ia-tmu-ge2026
   ```

#### 6. 依存関係のインストール

プロジェクトで使用するライブラリをインストールします。

```bash
pnpm install
```

このコマンドを実行すると、`package.json`に記載されている必要なパッケージが自動的にインストールされます。初回は数分かかる場合があります。

#### 7. 開発サーバーの起動

開発用のサーバーを起動して、ブラウザでアプリケーションを確認できます。

```bash
pnpm dev
```

コマンドを実行すると、以下のようなメッセージが表示されます：

```text
  ▲ Next.js 16.x.x
  - Local:        http://localhost:3000
```

ブラウザで `http://localhost:3000` を開くと、アプリケーションが表示されます。

開発サーバーを停止するには、ターミナルで `Ctrl + C`（macOS/Linux）または `Ctrl + C`（Windows）を押します。

#### 8. ビルド（本番用のファイル生成）

本番環境にデプロイする前に、プロジェクトをビルドします。

```bash
pnpm build
```

ビルドが成功すると、`.next` ディレクトリに最適化されたファイルが生成されます。

## 静的エクスポート（Static Export）

このプロジェクトは、Next.js の静的エクスポート機能を使用して、静的 HTML ファイルを生成できます。生成されたファイルは、通常の Web サーバーにアップロードするだけで動作します。

### 静的エクスポートとは

静的エクスポートは、Next.js アプリケーションを完全に静的な HTML、CSS、JavaScript ファイルに変換する機能です。サーバーサイドの処理が不要なため、通常の Web サーバー（Apache、Nginx など）でホスティングできます。

### 静的エクスポートの実行方法

静的エクスポートを実行するには、以下のコマンドを実行します：

```bash
pnpm run build
```

このコマンドは以下の処理を実行します：

1. Next.js のビルドを実行（静的エクスポートモード）
2. `out` ディレクトリに静的ファイルを生成
3. ルートパス（`/ge2026`）へのアクセス用に `index.html` を自動生成

ビルドが成功すると、`out` ディレクトリに以下のような構造でファイルが生成されます：

```
out/
├── index.html          # ルートアクセス用（言語検出とリダイレクト）
├── ja/                 # 日本語版ページ
├── en/                 # 英語版ページ
├── images/             # 画像ファイル
├── locales/            # 翻訳ファイル
└── _next/              # Next.js のアセット
```

### ローカルでの確認方法

静的エクスポートされたファイルをローカルで確認するには、以下のコマンドを実行します：

```bash
npm run serve:export
```

このコマンドは以下の処理を実行します：

1. `out` ディレクトリに `ge2026` シンボリックリンクを作成（`basePath` 対応）
2. 静的ファイルサーバーを起動（デフォルトポート: 3001）

ブラウザで以下の URL にアクセスして確認できます：

- **日本語版**: `http://localhost:3001/ge2026/ja/` または `http://localhost:3001/ja/`
- **英語版**: `http://localhost:3001/ge2026/en/` または `http://localhost:3001/en/`
- **ルート**: `http://localhost:3001/ge2026/` （自動的に言語設定に応じてリダイレクト）

**重要**: `basePath: "/ge2026"` が設定されているため、**`/ge2026/` プレフィックス付きの URL** でアクセスすると、JavaScript や CSS などのアセットが正しく読み込まれます。

### デプロイ時の手順

静的エクスポートされたファイルを本番サーバー（`https://industrial-art.sd.tmu.ac.jp/ge2026/`）にデプロイする手順：

#### 1. 静的ファイルの生成

```bash
pnpm run build
```

ビルドが成功すると、`out` ディレクトリに静的ファイルが生成されます。

#### 2. ファイルの確認

生成されたファイルを確認します：

```bash
ls -la out/
```

以下のファイルが生成されていることを確認してください：

- `index.html` - ルートアクセス用（自動生成）
- `ja/` - 日本語版ページ
- `en/` - 英語版ページ
- `images/` - 画像ファイル
- `locales/` - 翻訳ファイル
- `_next/` - Next.js のアセット

#### 3. サーバーへのアップロード

**本プロジェクトでは自動デプロイが設定されているため、手動でのアップロードは不要です。**
`main` ブランチに `out` ディレクトリを含めてプッシュすることで、自動的に反映されます。

（参考：手動でアップロードする場合）
`out` ディレクトリの内容を、本番サーバーの `/ge2026/` ディレクトリにアップロードします。

**アップロード方法の例：**

- **FTP/SFTP を使用する場合**:

  ```bash
  # out ディレクトリの内容をサーバーの /ge2026/ にアップロード
  scp -r out/* user@server:/path/to/ge2026/
  ```

- **rsync を使用する場合**:
  ```bash
  rsync -avz out/ user@server:/path/to/ge2026/
  ```

#### 4. 動作確認

アップロード後、以下の URL で動作を確認します：

- `https://industrial-art.sd.tmu.ac.jp/ge2026/` - ルートアクセス（自動的に `/ge2026/ja/` または `/ge2026/en/` にリダイレクト）
- `https://industrial-art.sd.tmu.ac.jp/ge2026/ja/` - 日本語版
- `https://industrial-art.sd.tmu.ac.jp/ge2026/en/` - 英語版

### 注意事項

#### basePath について

このプロジェクトは `basePath: "/ge2026"` が設定されています。これは、本番環境で `/ge2026/` 配下で動作することを想定しているためです。

- **開発モード** (`npm run dev`): `basePath` は無効化され、ルートパスで動作します
- **Vercel 環境**: `basePath` は空文字列になり、ルートパスで動作します
- **本番環境**: `basePath: "/ge2026"` が有効になります

#### index.html の自動生成

ビルド時に、`out/index.html` が自動的に生成されます。このファイルは、`/ge2026` にアクセスした際に、ブラウザの言語設定に基づいて適切な言語版（`/ge2026/ja/` または `/ge2026/en/`）にリダイレクトします。

#### 動的ルートについて

静的エクスポートでは、動的ルート（`[slug]` など）を使用する場合、`generateStaticParams()` 関数を実装する必要があります。

**`/[locale]/works/[slug]` ページのビルドエラーについて：**

現在、`/[locale]/works/[slug]` ページは Next.js 16.0.7 のバグにより、`generateStaticParams()` を正しく実装していてもビルド時にエラーが発生する可能性があります。現時点では、このページは使用されていないため、一時的に無効化（`.disabled` にリネーム）しています。

**エラーが発生した場合の対応：**

1. **ページを一時的に無効化する（推奨）**:

   ```bash
   mv app/[locale]/works/[slug] app/[locale]/works/[slug].disabled
   ```

2. **ビルドキャッシュをクリアして再ビルド**:

   ```bash
   rm -rf .next
   pnpm run build
   ```

3. **将来的にこのページが必要になった場合**:
   - Next.js を最新バージョンにアップグレード（バグ修正の可能性）
   - 別の実装方法を検討（例: キャッチオールルート `[...slug]` の使用）

#### 画像の最適化

静的エクスポートでは、Next.js の画像最適化機能が使用できません。そのため、`next.config.ts` で `images: { unoptimized: true }` が設定されています。画像は元のサイズのまま配信されます。

### トラブルシューティング

**Node.js のバージョンが合わない場合：**

- nvm を使用している場合：`nvm use` を実行してください
- nvm を使用していない場合：Node.js を 20.20.0 以上にアップデートしてください

**pnpm コマンドが認識されない場合：**

- ターミナルを再起動してください
- `npm install -g pnpm` を再度実行してください

**依存関係のインストールでエラーが出る場合：**

- Node.js のバージョンが 20.20.0 以上であることを確認してください
- `node_modules` フォルダと `pnpm-lock.yaml` を削除して、再度 `pnpm install` を実行してください

**開発サーバーが起動しない場合：**

- ポート 3000 が他のアプリケーションで使用されていないか確認してください
- エラーメッセージを確認して、必要なパッケージがインストールされているか確認してください

**静的エクスポートのビルドでエラーが発生する場合：**

- `/[locale]/works/[slug]` ページのエラーが発生する場合:

  - 該当ページが一時的に無効化されているか確認してください
  - 無効化されていない場合は、上記の「動的ルートについて」セクションを参照してください

- TypeScript の型エラーが発生する場合:

  ```bash
  rm -rf .next
  pnpm run build
  ```

  ビルドキャッシュをクリアしてから再ビルドしてください

- `generateStaticParams()` が認識されない場合:
  - 関数が正しく `export` されているか確認してください
  - 戻り値の型が正しく指定されているか確認してください
  - Next.js のバージョンを確認し、必要に応じてアップグレードしてください
